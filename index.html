<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›¹ ì¶”ì  ì‹¤í—˜ - í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2em;
        }
        
        .description {
            color: #666;
            margin-bottom: 40px;
            text-align: center;
            line-height: 1.6;
        }
        
        .button-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-button {
            padding: 20px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .test-button:active {
            transform: translateY(0);
        }
        
        #purchase-button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        #ad-banner {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .status {
            margin-top: 30px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ì›¹ ì¶”ì  ì‹¤í—˜</h1>
        <p class="description">
            ì´ í˜ì´ì§€ëŠ” ì›¹ì‚¬ì´íŠ¸ ì¶”ì  ë° í•‘ê±°í”„ë¦°íŒ… ì‹¤í—˜ì„ ìœ„í•œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ì…ë‹ˆë‹¤.<br>
            ì•„ë˜ ë²„íŠ¼ë“¤ì„ í´ë¦­í•˜ì—¬ í™œë™ ë¡œê¹…ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.
        </p>
        
        <div class="button-container">
            <button id="purchase-button" class="test-button">
                ğŸ›’ êµ¬ë§¤ ë²„íŠ¼
            </button>
            
            <button id="ad-banner" class="test-button">
                ğŸ“¢ ê´‘ê³  ë°°ë„ˆ
            </button>
        </div>
        
        <div id="status" class="status hidden">
            ë¡œë”© ì¤‘...
        </div>
    </div>

    <script>
        // ============================================
        // 1. ê³ ìœ  ID ê´€ë¦¬ ëª¨ë“ˆ
        // ============================================
        const UserIDManager = {
            // ê³ ìœ  ID ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸°
            getOrCreateUserID: function() {
                const STORAGE_KEY = 'user_unique_id';
                const COOKIE_NAME = 'user_unique_id';
                
                // ì¿ í‚¤ì—ì„œ ID í™•ì¸
                let userId = this.getCookie(COOKIE_NAME);
                
                // ì¿ í‚¤ì— ì—†ìœ¼ë©´ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ í™•ì¸
                if (!userId && typeof(Storage) !== "undefined" && localStorage) {
                    userId = localStorage.getItem(STORAGE_KEY);
                }
                
                // ë‘˜ ë‹¤ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
                if (!userId) {
                    userId = this.generateUniqueID();
                    // ì¿ í‚¤ì™€ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ëª¨ë‘ì— ì €ì¥
                    this.setCookie(COOKIE_NAME, userId, 365); // 1ë…„
                    if (typeof(Storage) !== "undefined" && localStorage) {
                        localStorage.setItem(STORAGE_KEY, userId);
                    }
                }
                
                return userId;
            },
            
            // ê³ ìœ  ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤)
            generateUniqueID: function() {
                return 'uid_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            },
            
            // ì¿ í‚¤ ì„¤ì •
            setCookie: function(name, value, days) {
                const expires = new Date();
                expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
                document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/';
            },
            
            // ì¿ í‚¤ ê°€ì ¸ì˜¤ê¸°
            getCookie: function(name) {
                const nameEQ = name + "=";
                const ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }
        };

        // ============================================
        // 2. ê¸°ë³¸ ë¸Œë¼ìš°ì € ì •ë³´ ìˆ˜ì§‘ ëª¨ë“ˆ
        // ============================================
        const BrowserInfoCollector = {
            collect: function() {
                return {
                    user_agent: navigator.userAgent,
                    language: navigator.language,
                    languages: navigator.languages || [],
                    platform: navigator.platform,
                    cookieEnabled: navigator.cookieEnabled,
                    doNotTrack: navigator.doNotTrack,
                    hardwareConcurrency: navigator.hardwareConcurrency || "unknown",
                    maxTouchPoints: navigator.maxTouchPoints || 0,
                    deviceMemory: navigator.deviceMemory || "unknown"
                };
            }
        };

        // ============================================
        // 3. í™”ë©´ ì •ë³´ ìˆ˜ì§‘ ëª¨ë“ˆ
        // ============================================
        const ScreenInfoCollector = {
            collect: function() {
                return {
                    width: screen.width,
                    height: screen.height,
                    availWidth: screen.availWidth,
                    availHeight: screen.availHeight,
                    colorDepth: screen.colorDepth,
                    pixelDepth: screen.pixelDepth
                };
            }
        };

        // ============================================
        // 4. ì‹œê°„ëŒ€ ì •ë³´ ìˆ˜ì§‘ ëª¨ë“ˆ
        // ============================================
        const TimezoneCollector = {
            collect: function() {
                return {
                    offset: new Date().getTimezoneOffset(),
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                };
            }
        };

        // ============================================
        // 5. ì •êµí•œ Canvas í•‘ê±°í”„ë¦°íŠ¸ ëª¨ë“ˆ
        // ============================================
        const CanvasFingerprintCollector = {
            collect: function() {
                const fingerprints = [];
                
                // ì—¬ëŸ¬ ë³€í˜•ì˜ Canvas í•‘ê±°í”„ë¦°íŠ¸ ìƒì„±
                const variations = [
                    { width: 200, height: 50, text: 'Canvas fingerprint test ğŸ”', font: '14px Arial' },
                    { width: 300, height: 100, text: 'Fingerprint Test 123', font: '16px Times New Roman' },
                    { width: 150, height: 75, text: 'Test', font: '20px Verdana' }
                ];
                
                variations.forEach((variation, index) => {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = variation.width;
                        canvas.height = variation.height;
                        const ctx = canvas.getContext('2d');
                        
                        // ë‹¤ì–‘í•œ ë Œë”ë§ ê¸°ë²• ì ìš©
                        ctx.textBaseline = 'top';
                        ctx.font = variation.font;
                        ctx.fillStyle = '#f60';
                        ctx.fillRect(125, 1, 62, 20);
                        ctx.fillStyle = '#069';
                        ctx.fillText(variation.text, 2, 15);
                        ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                        ctx.fillText(variation.text, 4, 17);
                        
                        // ê·¸ë¼ë””ì–¸íŠ¸ ì¶”ê°€
                        const gradient = ctx.createLinearGradient(0, 0, variation.width, variation.height);
                        gradient.addColorStop(0, 'rgba(255, 0, 0, 0.5)');
                        gradient.addColorStop(1, 'rgba(0, 0, 255, 0.5)');
                        ctx.fillStyle = gradient;
                        ctx.fillRect(10, 10, 50, 30);
                        
                        const dataURL = canvas.toDataURL();
                        fingerprints.push({
                            variation: index + 1,
                            hash: this.hashCode(dataURL),
                            preview: dataURL.substring(0, 100) + "..."
                        });
                    } catch (e) {
                        console.warn(`Canvas í•‘ê±°í”„ë¦°íŠ¸ ${index + 1} ìƒì„± ì‹¤íŒ¨:`, e);
                    }
                });
                
                return fingerprints.length > 0 ? fingerprints : "not_available";
            },
            
            hashCode: function(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32bit integer
                }
                return hash.toString();
            }
        };

        // ============================================
        // 6. ì •êµí•œ WebGL í•‘ê±°í”„ë¦°íŠ¸ ëª¨ë“ˆ
        // ============================================
        const WebGLFingerprintCollector = {
            collect: function() {
                const fingerprints = [];
                
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    
                    if (!gl) {
                        return "not_available";
                    }
                    
                    // ê¸°ë³¸ WebGL ì •ë³´
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    const basicInfo = {
                        vendor: gl.getParameter(gl.VENDOR),
                        renderer: gl.getParameter(gl.RENDERER),
                        version: gl.getParameter(gl.VERSION),
                        shading_language: gl.getParameter(gl.SHADING_LANGUAGE_VERSION)
                    };
                    
                    if (debugInfo) {
                        basicInfo.unmasked_vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
                        basicInfo.unmasked_renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                    }
                    
                    // WebGL íŒŒë¼ë¯¸í„° ìˆ˜ì§‘
                    const parameters = [
                        'MAX_TEXTURE_SIZE', 'MAX_CUBE_MAP_TEXTURE_SIZE', 'MAX_VIEWPORT_DIMS',
                        'MAX_VERTEX_ATTRIBS', 'MAX_VERTEX_UNIFORM_VECTORS', 'MAX_FRAGMENT_UNIFORM_VECTORS',
                        'ALIASED_LINE_WIDTH_RANGE', 'ALIASED_POINT_SIZE_RANGE'
                    ];
                    
                    const paramValues = {};
                    parameters.forEach(param => {
                        try {
                            paramValues[param] = gl.getParameter(gl[param]);
                        } catch (e) {}
                    });
                    
                    // WebGL í™•ì¥ ì •ë³´
                    const extensions = gl.getSupportedExtensions() || [];
                    
                    // WebGL ë Œë”ë§ í•‘ê±°í”„ë¦°íŠ¸
                    let renderFingerprint = "not_available";
                    try {
                        const vertexShader = gl.createShader(gl.VERTEX_SHADER);
                        gl.shaderSource(vertexShader, `
                            attribute vec2 attr;
                            void main(void) { gl_Position = vec4(attr, 0.0, 1.0); }
                        `);
                        gl.compileShader(vertexShader);
                        
                        const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
                        gl.shaderSource(fragmentShader, `
                            precision mediump float;
                            void main(void) { gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0); }
                        `);
                        gl.compileShader(fragmentShader);
                        
                        const program = gl.createProgram();
                        gl.attachShader(program, vertexShader);
                        gl.attachShader(program, fragmentShader);
                        gl.linkProgram(program);
                        gl.useProgram(program);
                        
                        const buffer = gl.createBuffer();
                        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
                        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-0.2, -0.9, 0, 0.4, -0.26, 0, 0, 0.732134444, 0]), gl.STATIC_DRAW);
                        
                        const attr = gl.getAttribLocation(program, 'attr');
                        gl.enableVertexAttribArray(attr);
                        gl.vertexAttribPointer(attr, 3, gl.FLOAT, false, 0, 0);
                        gl.drawArrays(gl.TRIANGLES, 0, 3);
                        
                        const pixels = new Uint8Array(4);
                        gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);
                        renderFingerprint = Array.from(pixels).join(',');
                    } catch (e) {
                        console.warn("WebGL ë Œë”ë§ í•‘ê±°í”„ë¦°íŠ¸ ìƒì„± ì‹¤íŒ¨:", e);
                    }
                    
                    return {
                        basic_info: basicInfo,
                        parameters: paramValues,
                        extensions: extensions,
                        render_fingerprint: renderFingerprint
                    };
                } catch (e) {
                    console.warn("WebGL ì •ë³´ ìˆ˜ì§‘ ì‹¤íŒ¨:", e);
                    return "not_available";
                }
            }
        };

        // ============================================
        // 7. AudioContext í•‘ê±°í”„ë¦°íŠ¸ ëª¨ë“ˆ
        // ============================================
        const AudioFingerprintCollector = {
            collect: function(callback) {
                let audioFingerprint = "not_available";
                
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const analyser = audioContext.createAnalyser();
                    const gainNode = audioContext.createGain();
                    
                    gainNode.gain.value = 0; // ì†Œë¦¬ ì—†ì´
                    oscillator.type = 'triangle';
                    oscillator.connect(analyser);
                    analyser.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start(0);
                    
                    setTimeout(() => {
                        try {
                            const output = new Float32Array(analyser.frequencyBinCount);
                            analyser.getFloatFrequencyData(output);
                            let hash = 0;
                            for (let i = 0; i < output.length; i++) {
                                hash += Math.abs(output[i]);
                            }
                            audioFingerprint = hash.toString();
                            oscillator.stop();
                            audioContext.close();
                            if (callback) callback(audioFingerprint);
                        } catch (e) {
                            console.warn("AudioContext ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨:", e);
                            if (callback) callback(audioFingerprint);
                        }
                    }, 100);
                } catch (e) {
                    console.warn("AudioContext í•‘ê±°í”„ë¦°íŠ¸ ìƒì„± ì‹¤íŒ¨:", e);
                    if (callback) callback(audioFingerprint);
                }
                
                return audioFingerprint;
            }
        };

        // ============================================
        // 8. Font í•‘ê±°í”„ë¦°íŠ¸ ëª¨ë“ˆ
        // ============================================
        const FontFingerprintCollector = {
            collect: function() {
                const testFonts = [
                    'Arial', 'Verdana', 'Times New Roman', 'Courier New', 'Georgia',
                    'Palatino', 'Garamond', 'Bookman', 'Comic Sans MS', 'Trebuchet MS',
                    'Impact', 'Lucida Console', 'Tahoma', 'Courier', 'Lucida Sans Unicode',
                    'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', 'Apple SD Gothic Neo', 'Nanum Gothic',
                    'Noto Sans KR', 'ë‚˜ëˆ”ê³ ë”•', 'NanumGothic'
                ];
                
                const fontFingerprint = [];
                const testString = "mmmmmmmmmmlli";
                const testSize = "72px";
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                context.textBaseline = 'top';
                context.font = testSize + ' monospace';
                const baselineWidth = context.measureText(testString).width;
                
                testFonts.forEach(font => {
                    context.font = testSize + ' ' + font + ', monospace';
                    const width = context.measureText(testString).width;
                    if (width !== baselineWidth) {
                        fontFingerprint.push(font);
                    }
                });
                
                return fontFingerprint;
            }
        };

        // ============================================
        // 9. WebRTC IP ìˆ˜ì§‘ ëª¨ë“ˆ
        // ============================================
        const WebRTCCollector = {
            collect: function(callback) {
                let webrtcIPs = [];
                
                try {
                    const rtcConfig = {
                        iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
                    };
                    const pc = new RTCPeerConnection(rtcConfig);
                    pc.createDataChannel("");
                    
                    pc.onicecandidate = function(event) {
                        if (event.candidate) {
                            const candidate = event.candidate.candidate;
                            const ipMatch = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(candidate);
                            if (ipMatch && !webrtcIPs.includes(ipMatch[1])) {
                                webrtcIPs.push(ipMatch[1]);
                            }
                        }
                    };
                    
                    pc.createOffer().then(offer => pc.setLocalDescription(offer));
                    
                    setTimeout(() => {
                        pc.close();
                        if (callback) callback(webrtcIPs);
                    }, 2000);
                } catch (e) {
                    console.warn("WebRTC ìˆ˜ì§‘ ì‹¤íŒ¨:", e);
                    if (callback) callback(webrtcIPs);
                }
            }
        };

        // ============================================
        // 10. Battery API ëª¨ë“ˆ
        // ============================================
        const BatteryCollector = {
            collect: function(callback) {
                let batteryInfo = "not_available";
                
                if (navigator.getBattery) {
                    navigator.getBattery().then(battery => {
                        batteryInfo = {
                            charging: battery.charging,
                            chargingTime: battery.chargingTime,
                            dischargingTime: battery.dischargingTime,
                            level: battery.level
                        };
                        if (callback) callback(batteryInfo);
                    }).catch(() => {
                        if (callback) callback(batteryInfo);
                    });
                } else {
                    if (callback) callback(batteryInfo);
                }
            }
        };

        // ============================================
        // 11. MediaDevices ëª¨ë“ˆ
        // ============================================
        const MediaDevicesCollector = {
            collect: function(callback) {
                let mediaDevices = "not_available";
                
                if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                    navigator.mediaDevices.enumerateDevices().then(devices => {
                        mediaDevices = devices.map(device => ({
                            kind: device.kind,
                            label: device.label || "permission_denied",
                            deviceId: device.deviceId ? device.deviceId.substring(0, 20) + "..." : "none"
                        }));
                        if (callback) callback(mediaDevices);
                    }).catch(() => {
                        if (callback) callback(mediaDevices);
                    });
                } else {
                    if (callback) callback(mediaDevices);
                }
            }
        };

        // ============================================
        // 12. Performance API ëª¨ë“ˆ
        // ============================================
        const PerformanceCollector = {
            collect: function() {
                return {
                    timing: performance.timing ? {
                        navigationStart: performance.timing.navigationStart,
                        domContentLoaded: performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart,
                        loadComplete: performance.timing.loadEventEnd - performance.timing.navigationStart
                    } : "not_available",
                    memory: performance.memory ? {
                        usedJSHeapSize: performance.memory.usedJSHeapSize,
                        totalJSHeapSize: performance.memory.totalJSHeapSize,
                        jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
                    } : "not_available"
                };
            }
        };

        // ============================================
        // 13. CSS ë¯¸ë””ì–´ ì¿¼ë¦¬ ëª¨ë“ˆ
        // ============================================
        const MediaQueryCollector = {
            collect: function() {
                return {
                    prefersColorScheme: window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light',
                    prefersReducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches,
                    pointer: window.matchMedia('(pointer: fine)').matches ? 'fine' : 'coarse',
                    hover: window.matchMedia('(hover: hover)').matches
                };
            }
        };

        // ============================================
        // 14. Storage ì •ë³´ ëª¨ë“ˆ
        // ============================================
        const StorageCollector = {
            collect: function() {
                return {
                    localStorage: typeof(Storage) !== "undefined" && typeof localStorage !== "undefined",
                    sessionStorage: typeof(Storage) !== "undefined" && typeof sessionStorage !== "undefined",
                    indexedDB: typeof indexedDB !== "undefined"
                };
            }
        };

        // ============================================
        // 15. ë§ˆìš°ìŠ¤ ì›€ì§ì„ íŒ¨í„´ ìˆ˜ì§‘ ëª¨ë“ˆ
        // ============================================
        const MousePatternCollector = {
            movements: [],
            startTime: null,
            isCollecting: false,
            
            start: function() {
                this.movements = [];
                this.startTime = Date.now();
                this.isCollecting = true;
                
                document.addEventListener('mousemove', this.onMouseMove.bind(this));
                document.addEventListener('mouseleave', this.stop.bind(this));
                
                // 10ì´ˆ í›„ ìë™ìœ¼ë¡œ ìˆ˜ì§‘ ì¤‘ì§€
                setTimeout(() => this.stop(), 10000);
            },
            
            onMouseMove: function(event) {
                if (!this.isCollecting) return;
                
                const now = Date.now();
                const timeSinceStart = now - this.startTime;
                
                this.movements.push({
                    x: event.clientX,
                    y: event.clientY,
                    timestamp: timeSinceStart,
                    pageX: event.pageX,
                    pageY: event.pageY
                });
                
                // ìµœëŒ€ 100ê°œê¹Œì§€ë§Œ ì €ì¥
                if (this.movements.length > 100) {
                    this.movements.shift();
                }
            },
            
            stop: function() {
                this.isCollecting = false;
                document.removeEventListener('mousemove', this.onMouseMove.bind(this));
                document.removeEventListener('mouseleave', this.stop.bind(this));
            },
            
            getPattern: function() {
                if (this.movements.length < 2) {
                    return null;
                }
                
                // íŒ¨í„´ ë¶„ì„
                const velocities = [];
                const accelerations = [];
                const angles = [];
                
                for (let i = 1; i < this.movements.length; i++) {
                    const prev = this.movements[i - 1];
                    const curr = this.movements[i];
                    
                    const dx = curr.x - prev.x;
                    const dy = curr.y - prev.y;
                    const dt = curr.timestamp - prev.timestamp;
                    
                    if (dt > 0) {
                        const velocity = Math.sqrt(dx * dx + dy * dy) / dt;
                        velocities.push(velocity);
                        
                        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                        angles.push(angle);
                    }
                }
                
                for (let i = 1; i < velocities.length; i++) {
                    const accel = velocities[i] - velocities[i - 1];
                    accelerations.push(accel);
                }
                
                // í†µê³„ ê³„ì‚°
                const avgVelocity = velocities.reduce((a, b) => a + b, 0) / velocities.length;
                const avgAcceleration = accelerations.length > 0 ? 
                    accelerations.reduce((a, b) => a + b, 0) / accelerations.length : 0;
                
                return {
                    totalMovements: this.movements.length,
                    duration: this.movements[this.movements.length - 1].timestamp,
                    averageVelocity: avgVelocity,
                    averageAcceleration: avgAcceleration,
                    movementCount: this.movements.length,
                    sampleData: this.movements.slice(0, 10) // ì²˜ìŒ 10ê°œ ìƒ˜í”Œë§Œ
                };
            }
        };

        // ============================================
        // 16. í‚¤ë³´ë“œ íƒ€ì´í•‘ íŒ¨í„´ ìˆ˜ì§‘ ëª¨ë“ˆ
        // ============================================
        const KeyboardPatternCollector = {
            keystrokes: [],
            startTime: null,
            isCollecting: false,
            
            start: function() {
                this.keystrokes = [];
                this.startTime = Date.now();
                this.isCollecting = true;
                
                document.addEventListener('keydown', this.onKeyDown.bind(this));
                document.addEventListener('keyup', this.onKeyUp.bind(this));
                
                // 30ì´ˆ í›„ ìë™ìœ¼ë¡œ ìˆ˜ì§‘ ì¤‘ì§€
                setTimeout(() => this.stop(), 30000);
            },
            
            onKeyDown: function(event) {
                if (!this.isCollecting) return;
                
                const now = Date.now();
                const timeSinceStart = now - this.startTime;
                
                this.keystrokes.push({
                    key: event.key,
                    code: event.code,
                    timestamp: timeSinceStart,
                    type: 'down'
                });
            },
            
            onKeyUp: function(event) {
                if (!this.isCollecting) return;
                
                const now = Date.now();
                const timeSinceStart = now - this.startTime;
                
                this.keystrokes.push({
                    key: event.key,
                    code: event.code,
                    timestamp: timeSinceStart,
                    type: 'up'
                });
            },
            
            stop: function() {
                this.isCollecting = false;
                document.removeEventListener('keydown', this.onKeyDown.bind(this));
                document.removeEventListener('keyup', this.onKeyUp.bind(this));
            },
            
            getPattern: function() {
                if (this.keystrokes.length < 2) {
                    return null;
                }
                
                // í‚¤ ëˆ„ë¦„-ë–¼ê¸° ìŒ ì°¾ê¸°
                const keyPairs = [];
                for (let i = 0; i < this.keystrokes.length - 1; i++) {
                    if (this.keystrokes[i].type === 'down' && this.keystrokes[i + 1].type === 'up' && 
                        this.keystrokes[i].key === this.keystrokes[i + 1].key) {
                        const holdTime = this.keystrokes[i + 1].timestamp - this.keystrokes[i].timestamp;
                        keyPairs.push({
                            key: this.keystrokes[i].key,
                            holdTime: holdTime
                        });
                    }
                }
                
                // í‚¤ ê°„ ê°„ê²© ê³„ì‚°
                const intervals = [];
                for (let i = 1; i < this.keystrokes.length; i++) {
                    if (this.keystrokes[i].type === 'down' && this.keystrokes[i - 1].type === 'down') {
                        intervals.push(this.keystrokes[i].timestamp - this.keystrokes[i - 1].timestamp);
                    }
                }
                
                // í†µê³„ ê³„ì‚°
                const avgHoldTime = keyPairs.length > 0 ? 
                    keyPairs.reduce((a, b) => a + b.holdTime, 0) / keyPairs.length : 0;
                const avgInterval = intervals.length > 0 ? 
                    intervals.reduce((a, b) => a + b, 0) / intervals.length : 0;
                
                return {
                    totalKeystrokes: this.keystrokes.length,
                    duration: this.keystrokes[this.keystrokes.length - 1].timestamp,
                    averageHoldTime: avgHoldTime,
                    averageInterval: avgInterval,
                    keyPairsCount: keyPairs.length,
                    sampleData: keyPairs.slice(0, 10) // ì²˜ìŒ 10ê°œ ìƒ˜í”Œë§Œ
                };
            }
        };

        // ============================================
        // 17. ë°ì´í„° ì „ì†¡ ëª¨ë“ˆ
        // ============================================
        const DataSender = {
            sendFingerprint: function(data) {
                fetch('/api/fingerprint', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    console.log("âœ… í•‘ê±°í”„ë¦°íŠ¸ ì „ì†¡ ì™„ë£Œ:", data);
                })
                .catch(error => {
                    console.error("âŒ í•‘ê±°í”„ë¦°íŠ¸ ì „ì†¡ ì‹¤íŒ¨:", error);
                });
            },
            
            sendActivity: function(data) {
                fetch('/api/log_event', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    console.log("âœ… í™œë™ ë¡œê·¸ ì „ì†¡ ì™„ë£Œ:", data);
                })
                .catch(error => {
                    console.error("âŒ í™œë™ ë¡œê·¸ ì „ì†¡ ì‹¤íŒ¨:", error);
                });
            },
            
            sendBehaviorPattern: function(data) {
                fetch('/api/behavior_pattern', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    console.log("âœ… í–‰ë™ íŒ¨í„´ ì „ì†¡ ì™„ë£Œ:", data);
                })
                .catch(error => {
                    console.error("âŒ í–‰ë™ íŒ¨í„´ ì „ì†¡ ì‹¤íŒ¨:", error);
                });
            }
        };

        // ============================================
        // ë©”ì¸ ì‹¤í–‰ ë¡œì§
        // ============================================
        (function() {
            console.log("ğŸ” í•‘ê±°í”„ë¦°íŠ¸ ìˆ˜ì§‘ ì‹œì‘...");
            
            // ê³ ìœ  ID ê°€ì ¸ì˜¤ê¸°
            const userId = UserIDManager.getOrCreateUserID();
            console.log("ğŸ‘¤ ì‚¬ìš©ì ID:", userId);
            
            // ë™ê¸°ì ìœ¼ë¡œ ìˆ˜ì§‘ ê°€ëŠ¥í•œ ì •ë³´
            const fingerprintData = {
                user_id: userId,
                user_agent: BrowserInfoCollector.collect().user_agent,
                screen: ScreenInfoCollector.collect(),
                timezone: TimezoneCollector.collect(),
                canvas_fingerprint: CanvasFingerprintCollector.collect(),
                webgl: WebGLFingerprintCollector.collect(),
                audio_fingerprint: AudioFingerprintCollector.collect(),
                font_fingerprint: FontFingerprintCollector.collect(),
                performance: PerformanceCollector.collect(),
                media_queries: MediaQueryCollector.collect(),
                storage: StorageCollector.collect(),
                browser: BrowserInfoCollector.collect(),
                timestamp: new Date().toISOString()
            };
            
            // ë¹„ë™ê¸° ì •ë³´ ìˆ˜ì§‘ ì™„ë£Œ í›„ ì „ì†¡
            let asyncDataCollected = 0;
            const totalAsync = 3;
            
            const checkAndSend = function() {
                asyncDataCollected++;
                if (asyncDataCollected >= totalAsync) {
                    DataSender.sendFingerprint(fingerprintData);
                }
            };
            
            // WebRTC IP ìˆ˜ì§‘
            WebRTCCollector.collect(function(ips) {
                fingerprintData.webrtc_ips = ips;
                checkAndSend();
            });
            
            // Battery ì •ë³´ ìˆ˜ì§‘
            BatteryCollector.collect(function(battery) {
                fingerprintData.battery_info = battery;
                checkAndSend();
            });
            
            // MediaDevices ì •ë³´ ìˆ˜ì§‘
            MediaDevicesCollector.collect(function(devices) {
                fingerprintData.media_devices = devices;
                checkAndSend();
            });
            
            // AudioContextëŠ” ë³„ë„ë¡œ ì²˜ë¦¬ (ì‹œê°„ì´ ì¢€ ê±¸ë¦¼)
            AudioFingerprintCollector.collect(function(audio) {
                fingerprintData.audio_fingerprint = audio;
            });
            
            // ë§ˆìš°ìŠ¤ íŒ¨í„´ ìˆ˜ì§‘ ì‹œì‘
            MousePatternCollector.start();
            
            // í‚¤ë³´ë“œ íŒ¨í„´ ìˆ˜ì§‘ ì‹œì‘
            KeyboardPatternCollector.start();
            
            // 5ì´ˆ í›„ ë§ˆìš°ìŠ¤ íŒ¨í„´ ìˆ˜ì§‘ ë° ì „ì†¡
            setTimeout(() => {
                const mousePattern = MousePatternCollector.getPattern();
                if (mousePattern) {
                    DataSender.sendBehaviorPattern({
                        user_id: userId,
                        type: 'mouse_pattern',
                        data: mousePattern,
                        timestamp: new Date().toISOString()
                    });
                }
            }, 5000);
            
            // 15ì´ˆ í›„ í‚¤ë³´ë“œ íŒ¨í„´ ìˆ˜ì§‘ ë° ì „ì†¡
            setTimeout(() => {
                const keyboardPattern = KeyboardPatternCollector.getPattern();
                if (keyboardPattern) {
                    DataSender.sendBehaviorPattern({
                        user_id: userId,
                        type: 'keyboard_pattern',
                        data: keyboardPattern,
                        timestamp: new Date().toISOString()
                    });
                }
            }, 15000);
        })();
        
        // ============================================
        // í™œë™ ë¡œê¹…
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            const userId = UserIDManager.getOrCreateUserID();
            const purchaseButton = document.getElementById('purchase-button');
            const adBanner = document.getElementById('ad-banner');
            const statusDiv = document.getElementById('status');
            
            // êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            purchaseButton.addEventListener('click', function() {
                DataSender.sendActivity({
                    user_id: userId,
                    element_id: 'purchase-button',
                    action: 'êµ¬ë§¤ ë²„íŠ¼ í´ë¦­',
                    timestamp: new Date().toISOString(),
                    url: window.location.href,
                    user_agent: navigator.userAgent
                });
                statusDiv.textContent = 'âœ… êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.';
                statusDiv.classList.remove('hidden');
                setTimeout(() => statusDiv.classList.add('hidden'), 2000);
            });
            
            // ê´‘ê³  ë°°ë„ˆ í´ë¦­ ì´ë²¤íŠ¸
            adBanner.addEventListener('click', function() {
                DataSender.sendActivity({
                    user_id: userId,
                    element_id: 'ad-banner',
                    action: 'ê´‘ê³  ë°°ë„ˆ í´ë¦­',
                    timestamp: new Date().toISOString(),
                    url: window.location.href,
                    user_agent: navigator.userAgent
                });
                statusDiv.textContent = 'âœ… ê´‘ê³  ë°°ë„ˆ í´ë¦­ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.';
                statusDiv.classList.remove('hidden');
                setTimeout(() => statusDiv.classList.add('hidden'), 2000);
            });
            
            // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(function() {
                    DataSender.sendActivity({
                        user_id: userId,
                        element_id: 'scroll',
                        action: 'í˜ì´ì§€ ìŠ¤í¬ë¡¤',
                        timestamp: new Date().toISOString(),
                        url: window.location.href,
                        user_agent: navigator.userAgent
                    });
                }, 1000);
            });
        });
    </script>
</body>
</html>
